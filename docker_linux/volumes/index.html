<!doctype html><html lang=fr-fr dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.121.1"><meta name=generator content="Relearn 5.23.2+tip"><meta name=description content="TP Licence - Intro aux conteneurs"><meta name=author content="Alexandre P."><meta name=twitter:card content="summary"><meta name=twitter:title content="Les Volumes - Docker et Orchestration"><meta name=twitter:description content="Les volumes permettent plusieurs choses:
Passer outre le Copy On Write et utiliser les performances natives des disques. Partager des dossiers et fichiers entre les conteneurs Partager des dossiers et fichiers entre l&rsquo;h√¥te et les conteneurs Utiliser des points de montage distant Nous allons voir comment utiliser un volume:
Dans un Dockerfile Au demarrage avec l&rsquo;option -v En utilisant un volume nomm√© La persistance des donn√©es Illustrons l&rsquo;√©tat par d√©faut des donn√©es apr√®s l&rsquo;arr√™t d&rsquo;un conteneur"><meta property="og:title" content="Les Volumes - Docker et Orchestration"><meta property="og:description" content="Les volumes permettent plusieurs choses:
Passer outre le Copy On Write et utiliser les performances natives des disques. Partager des dossiers et fichiers entre les conteneurs Partager des dossiers et fichiers entre l&rsquo;h√¥te et les conteneurs Utiliser des points de montage distant Nous allons voir comment utiliser un volume:
Dans un Dockerfile Au demarrage avec l&rsquo;option -v En utilisant un volume nomm√© La persistance des donn√©es Illustrons l&rsquo;√©tat par d√©faut des donn√©es apr√®s l&rsquo;arr√™t d&rsquo;un conteneur"><meta property="og:type" content="article"><meta property="og:url" content="https://zaggash.github.io/tp-iut-docker/docker_linux/volumes/"><meta property="article:section" content="Docker et Linux - Docker et Orchestration"><meta property="article:published_time" content="2020-06-12T23:23:40+02:00"><meta property="article:modified_time" content="2020-06-12T23:23:40+02:00"><meta property="og:site_name" content="Docker et Orchestration"><title>Les Volumes - Docker et Orchestration</title>
<link href=../../css/fontawesome-all.min.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fontawesome-all.min.css rel=stylesheet></noscript><link href=../../css/nucleus.css rel=stylesheet><link href=../../css/auto-complete.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/auto-complete.css rel=stylesheet></noscript><link href=../../css/perfect-scrollbar.min.css rel=stylesheet><link href=../../css/fonts.css rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fonts.css rel=stylesheet></noscript><link href=../../css/theme.css rel=stylesheet><link href=../../css/theme-blue.css rel=stylesheet id=R-variant-style><link href=../../css/chroma-learn.css rel=stylesheet id=R-variant-chroma-style><link href=../../css/variant.css rel=stylesheet><link href=../../css/print.css rel=stylesheet media=print><link href=../../css/ie.css rel=stylesheet><script src=../../js/url.js></script><script src=../../js/variant.js></script><script>window.index_js_url="../../index.search.js";var root_url="../../",baseUri=root_url.replace(/\/$/,"");window.relearn=window.relearn||{},window.relearn.baseUriFull="https://zaggash.github.io/tp-iut-docker/",window.relearn.themeVariantModifier="",window.variants&&variants.init(["blue"]),window.T_Copy_to_clipboard=`Copier dans le presse-papiers`,window.T_Copied_to_clipboard=`Copi√© dans le presse-papiers!`,window.T_Copy_link_to_clipboard=`Copier le lien dans le presse-papiers`,window.T_Link_copied_to_clipboard=`Lien copi√© dans le presse-papiers!`,window.T_Reset_view=`R√©initialiser la vue`,window.T_View_reset=`Vue r√©initialis√©e!`,window.T_No_results_found=`Aucun r√©sultat trouv√© pour "{0}"`,window.T_N_results_found=`{1} r√©sultats trouv√©s pour "{0}"`</script></head><body class="mobile-support html" data-url=../../docker_linux/volumes/><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table des mati√®res (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper></div></div></div></div><span class="topbar-breadcrumbs highlightable">Les Volumes</span><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../docker_linux/networks/inside_network/ title="Dans le R√©seau (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../orchestration/ title="Orchestration (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Aller plus loin"><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=les-volumes>Les Volumes</h1><p>Les volumes permettent plusieurs choses:</p><ul><li>Passer outre le Copy On Write et utiliser les performances natives des disques.</li><li>Partager des dossiers et fichiers entre les conteneurs</li><li>Partager des dossiers et fichiers entre l&rsquo;h√¥te et les conteneurs</li><li>Utiliser des points de montage distant</li></ul><p>Nous allons voir comment utiliser un volume:</p><ul><li>Dans un Dockerfile</li><li>Au demarrage avec l&rsquo;option <strong>-v</strong></li><li>En utilisant un volume nomm√©</li></ul><hr><h4 id=la-persistance-des-donn√©es>La persistance des donn√©es</h4><p>Illustrons l&rsquo;√©tat par d√©faut des donn√©es apr√®s l&rsquo;arr√™t d&rsquo;un conteneur</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker container run -ti  --name c1  alpine sh</span></span></code></pre></div><p>On va cr√©er un dossier et un fichier √† l&rsquo;int√©rieur</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ mkdir /mon_dossier <span style=color:#f92672>&amp;&amp;</span> cd /mon_dossier <span style=color:#f92672>&amp;&amp;</span> touch monfichier.txt</span></span></code></pre></div><p>Nous allons maintenant voir que le layer R/W du conteneur n&rsquo;est pas accessible depuis l&rsquo;h√¥te.</p><p>Commen√ßons par quitter le conteneur</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ exit</span></span></code></pre></div><p>On va inspecter le notre conteneur pour trouver l&rsquo;emplacement du layer.<br>On peut utiliser la commande <code>inspect</code> et chercher le mot clef <strong>GraphDriver</strong></p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker container inspect c1</span></span></code></pre></div><p>On peut egalement utiliser la sortie avanc√© gr√¢ce au Template Go et voir directement l&rsquo;information.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker container inspect -f <span style=color:#e6db74>&#39;{{ json .GraphDriver }}&#39;</span> c1 | jq</span></span></code></pre></div><p>Vous devriez avoir un output qui ressemble √† √ßa:</p><div class="wrap-code highlight"><pre tabindex=0><code>{
  &#34;Data&#34;: {
    &#34;LowerDir&#34;: &#34;/var/lib/docker/overlay2/0b144df858ed09133fb9de89026b91cb1a8ecacb1464466cff9479f2267b69a0-init/diff:/var/lib/docker/overlay2/3385f7f394c776c48b391cd6e407816d3026cea3ff9f5526f05d631ff6b4ae55/diff&#34;,
    &#34;MergedDir&#34;: &#34;/var/lib/docker/overlay2/0b144df858ed09133fb9de89026b91cb1a8ecacb1464466cff9479f2267b69a0/merged&#34;,
    &#34;UpperDir&#34;: &#34;/var/lib/docker/overlay2/0b144df858ed09133fb9de89026b91cb1a8ecacb1464466cff9479f2267b69a0/diff&#34;,
    &#34;WorkDir&#34;: &#34;/var/lib/docker/overlay2/0b144df858ed09133fb9de89026b91cb1a8ecacb1464466cff9479f2267b69a0/work&#34;
  },
  &#34;Name&#34;: &#34;overlay2&#34;
}</code></pre></div><p>Depuis l&rsquo;h√¥te, si on regarde l&rsquo;emplacement du dossier contenu dans la key <strong>UpperDir</strong>, on peut voir que notre dossier /mon_dossier et notre fichier monfichier.txt sont l√†.<br>Executer la commande suivante pour voir le contenu de notre dossier /mon_dossier:</p><div class="wrap-code highlight"><pre tabindex=0><code>$ ls /var/lib/docker/overlay2/[ID_LAYER]/diff/mon_dossier</code></pre></div><p>Que se passe t-il si notre conteneur venait √† √™tre supprim√© ?</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker container rm c1</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Information</div><div class=box-content><p>Il semble que le dossier <strong>UpperDir</strong> ci-dessus, n&rsquo;existe plus. Pouvez vous le confirmer ?<br>Essayer de lancer de nouveau un <code>ls</code></p></div></div><p>Cela prouve que les donn√©es dans un conteneur ne sont pas persistantes, elles sont supprim√©es en m√™me temps que le conteneur.</p><h4 id=definir-un-volume-dans-un-dockerfile>Definir un volume dans un Dockerfile</h4><p>Nous allons cr√©√©r un Dockerfile bas√© sur <code>alpine</code> et definir /mon_dossier en tant que volume.<br>Cela signifie que tout ce que sera √©crit par un conteneur dans /mon_dossier existera en dehors du layer R/W du conteneur.</p><p>Utiliser le Dockerfile suivant:</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> alpine</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>VOLUME</span> [<span style=color:#e6db74>&#34;/mon_dossier&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;/bin/sh&#34;</span>]</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Information</div><div class=box-content><p>On definit ici <strong>/bin/sh</strong> en Entrypoint afin d&rsquo;avoir un shell en mode int√©ractif sans devoir sp√©cifier de commande.</p></div></div><p>Nous pouvons alors lancer la cr√©ation de l&rsquo;image</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker image build -t img1 .</span></span></code></pre></div><p>On peut alors lancer notre conteneur en mode int√©ractif √† partir de cette image.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker container run -ti --name c2 img1
</span></span><span style=display:flex><span>/# </span></span></code></pre></div><p>On peut donc maintenant aller dans /mon_dossier et cr√©er un fichier.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/# cd /mon_dossier
</span></span><span style=display:flex><span>/# touch hello.txt
</span></span><span style=display:flex><span>/# ls
</span></span><span style=display:flex><span>hello.txt</span></span></code></pre></div><p>On peut quitter le conteneur en le laissant tourner en arri√®re plan.<br>Il faut utiliser la combinaison de raccourcis : <code>ctrl+P/ctrl+Q</code><br>Puis v√©rifier que le conteneur est toujours actif.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker ps</span></span></code></pre></div><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Information</div><div class=box-content><p>Le conteneur c2 devrait √™tre list√©</p></div></div><p>On va alors inspecter ce conteneur pour conna√Ætre l&rsquo;emplacement de notre volume sur la VM.<br>On va utiliser directement les templates GO mais on pourrait utiliser un <code>docker inspect</code> puis chercher √† la main la clef <strong>Mount</strong></p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker inspect -f <span style=color:#e6db74>&#39;{{ json .Mounts }}&#39;</span>  c2 | jq</span></span></code></pre></div><p>Vous devriez avoir une sortie qui ressemble √† ca:</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;volume&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;2d47da3c88436afa4b35b084ba0060009066b26b042ee7b161b1d3215f1b06fd&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Source&#34;</span>: <span style=color:#e6db74>&#34;/var/lib/docker/volumes/2d47da3c88436afa4b35b084ba0060009066b26b042ee7b161b1d3215f1b06fd/_data&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Destination&#34;</span>: <span style=color:#e6db74>&#34;/mon_dossier&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Driver&#34;</span>: <span style=color:#e6db74>&#34;local&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Mode&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;RW&#34;</span>: true,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Propagation&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span></span></span></code></pre></div><p>Cette sortie montre que le volume /mon_dossier est situ√© dans <code>/var/lib/docker/volumes/[ID_VOLUME]/_data</code><br>Remplacer le chemin par le votre et v√©rifier que le fichier <code>hello.txt</code> est bien pr√©sent.</p><p>On peut maintenant supprimer c2</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker rm -f c2</span></span></code></pre></div><p>Valider que le fichier est toujours disponible √† l&rsquo;emplacement pr√©c√©dent.</p><h4 id=definir-un-volume-en-mode-int√©ractif>Definir un volume en mode int√©ractif</h4><p>On a vu comment d√©finir un volume via un Dockerfile, on peut aussi le d√©finir au lancement avec l&rsquo;option <code>-v</code></p><p>Executons un conteneur √† partir de l&rsquo;image <code>alpine</code>, on utilisera l&rsquo;option <code>-d</code> pour le passer en arri√®re plan.<br>Afin que le processus PID1 du conteneur reste actif, on utilise une commande qui pinger 1.1.1.1 en continue et ecrire le r√©sultat dans /mon_dossier.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run -d --name c3 -v /mon_dossier alpine sh -c <span style=color:#e6db74>&#39;ping 1.1.1.1 &gt; /mon_dossier/ping.txt&#39;</span></span></span></code></pre></div><p>Allons chercher l&rsquo;emplacement du volume:</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker inspect -f <span style=color:#e6db74>&#39;{{ json .Mounts }}&#39;</span> c3 | jq</span></span></code></pre></div><p>Nous avons quasiment la m√™me sortie qu&rsquo;avec le Dockefile, √† l&rsquo;exception des IDs</p><div class="wrap-code highlight"><pre tabindex=0><code>[
  {
    &#34;Type&#34;: &#34;volume&#34;,
    &#34;Name&#34;: &#34;0534a1308b43b5bb7f4f728daeedea7e9962a65b47df4d37e01b2ef89510bd13&#34;,
    &#34;Source&#34;: &#34;/var/lib/docker/volumes/0534a1308b43b5bb7f4f728daeedea7e9962a65b47df4d37e01b2ef89510bd13/_data&#34;,
    &#34;Destination&#34;: &#34;/mon_dossier&#34;,
    &#34;Driver&#34;: &#34;local&#34;,
    &#34;Mode&#34;: &#34;&#34;,
    &#34;RW&#34;: true,
    &#34;Propagation&#34;: &#34;&#34;
  }
]</code></pre></div><p>V√©rifions que le fichier existe bien dans le volume:</p><div class="wrap-code highlight"><pre tabindex=0><code>$ tail -f /var/lib/docker/volumes/&lt;VOLUME_ID&gt;/_data/ping.txt
64 bytes from 1.1.1.1: seq=11 ttl=59 time=0.807 ms
64 bytes from 1.1.1.1: seq=12 ttl=59 time=0.875 ms
64 bytes from 1.1.1.1: seq=13 ttl=59 time=0.828 ms
64 bytes from 1.1.1.1: seq=14 ttl=59 time=1.101 ms
64 bytes from 1.1.1.1: seq=15 ttl=59 time=1.039 ms
64 bytes from 1.1.1.1: seq=16 ttl=59 time=0.804 ms
[...]</code></pre></div><p>Le fichier ping.txt est rempli reguli√®rement par la commande de notre conteneur.<br>Si on supprime le conteneur, le processus va arr√™ter de remplir le fichier mais il ne sera psa supprim√©.</p><h4 id=utiliser-un-volume-nomm√©>Utiliser un volume nomm√©</h4><p>Nous allons utiliser la commande pour cr√©er un volume nomm√© <strong>web</strong>.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker volume create --name web</span></span></code></pre></div><p>Si nous listons les volumes existant, il devrait y avoir notre volume <strong>web</strong>.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker volume ls</span></span></code></pre></div><p>L&rsquo;output devrait ressembler √† √ßa:</p><div class="wrap-code highlight"><pre tabindex=0><code>DRIVER              VOLUME NAME
[...]]
local               web</code></pre></div><p>Pour les volumes, comme presque tous les objets dans Docker, on peut executer la commande <code>inpect</code>.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker volume inspect web
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;CreatedAt&#34;</span>: <span style=color:#e6db74>&#34;2020-06-14T14:27:06Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Driver&#34;</span>: <span style=color:#e6db74>&#34;local&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Labels&#34;</span>: <span style=color:#f92672>{}</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Mountpoint&#34;</span>: <span style=color:#e6db74>&#34;/var/lib/docker/volumes/web/_data&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;web&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Options&#34;</span>: <span style=color:#f92672>{}</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;Scope&#34;</span>: <span style=color:#e6db74>&#34;local&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span></span></span></code></pre></div><p>Le <strong>Mountpoint</strong> d√©fini ici est le chemin sur l&rsquo;h√¥te ou l&rsquo;on peut trouver le volume.<br>On peut voir que le chemin des volumes nomm√©s utilise le nom du volume au lieu de l&rsquo;ID comme dans les exemples pr√©c√©dents.</p><p>On peut maintenant utiliser ce volume et le monter dans un conteneur.<br>Nous allons utiliser <code>nginx</code> et monter le volume <strong>web</strong> dans le r√©pertoire <code>/usr/share/nginx/html</code> du conteneur.</p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Information</div><div class=box-content><p><code>/usr/share/nginx/html</code> est le r√©pertoire par defaut du serveur nginx. Il contient 2 fichiers : index.html et 50x.html</p></div></div><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run -d --name www -p 8080:80 -v web:/usr/share/nginx/html nginx</span></span></code></pre></div><p>Depuis l&rsquo;h√¥te, allons voir le contenu du volume.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ls /var/lib/docker/volumes/web/_data
</span></span><span style=display:flex><span>50x.html  index.html</span></span></code></pre></div><p>Le contenu du dossier <strong>/usr/share/nginx/html</strong> du conteneur <strong>www</strong> √† √©t√© copi√© dans le dossier <strong>/var/lib/docker/volumes/html/_data</strong> sur l&rsquo;h√¥te.<br>Allons v√©rifier la page d&rsquo;accueil de <strong>nginx</strong></p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl 127.0.0.1:8080
</span></span><span style=display:flex><span>&lt;!DOCTYPE html&gt;
</span></span><span style=display:flex><span>&lt;html&gt;
</span></span><span style=display:flex><span>&lt;head&gt;
</span></span><span style=display:flex><span>&lt;title&gt;Welcome to nginx!&lt;/title&gt;
</span></span><span style=display:flex><span>&lt;style&gt;
</span></span><span style=display:flex><span>    body <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        width: 35em;
</span></span><span style=display:flex><span>        margin: <span style=color:#ae81ff>0</span> auto;
</span></span><span style=display:flex><span>        font-family: Tahoma, Verdana, Arial, sans-serif;
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>&lt;/style&gt;
</span></span><span style=display:flex><span>&lt;/head&gt;
</span></span><span style=display:flex><span>&lt;body&gt;
</span></span><span style=display:flex><span>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
</span></span><span style=display:flex><span>&lt;p&gt;If you see this page, the nginx web server is successfully installed and
</span></span><span style=display:flex><span>working. Further configuration is required.&lt;/p&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;p&gt;For online documentation and support please refer to
</span></span><span style=display:flex><span>&lt;a href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://nginx.org/&#34;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
</span></span><span style=display:flex><span>Commercial support is available at
</span></span><span style=display:flex><span>&lt;a href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;http://nginx.com/&#34;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;p&gt;&lt;em&gt;Thank you <span style=color:#66d9ef>for</span> using nginx.&lt;/em&gt;&lt;/p&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;</span></span></code></pre></div><p>Depuis l&rsquo;h√¥te, nous pouvons d√©sormais modifier le fichier index.html et v√©rifier que nos changements sont bien pris en compte par le conteneur.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ cat<span style=color:#e6db74>&lt;&lt;END &gt;/var/lib/docker/volumes/web/_data/index.html
</span></span></span><span style=display:flex><span><span style=color:#e6db74>TOC TOC TOC !
</span></span></span><span style=display:flex><span><span style=color:#e6db74>END</span></span></span></code></pre></div><p>Allons voir de nouveau la page web</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl 127.0.0.1:8080
</span></span><span style=display:flex><span>TOC TOC TOC !</span></span></code></pre></div><p>Nous pouvons voir les changements que nous avons effectu√©s.</p><h4 id=monter-un-dossier-de-la-vm-dans-un-conteneur>Monter un dossier de la VM dans un conteneur.</h4><p>Nous allons maintenant monter un dossier de l&rsquo;h√¥te dans un conteneur en faisant un bind-mount avec l&rsquo;option <code>-v</code> : <strong>-v CHEMIN_HOTE:CHEMIN_CONTENEUR</strong></p><div class="box notices cstyle info"><div class=box-label><i class="fa-fw fas fa-info-circle"></i> Information</div><div class=box-content><p>CHEMIN_HOTE et CHEMIN_CONTENEUR peuvent √™tre un dossier ou un fichier.<br>Le chemin sur l&rsquo;h√¥te doit exister.</p></div></div><p>Il y a deux cas bien distincts:</p><ul><li>le CHEMIN_CONTENEUR n&rsquo;existe pas dans le conteneur.</li><li>le CHEMIN_CONTENEUR existe dans le conteneur.</li></ul><h5 id=nexiste-pas>N&rsquo;existe pas</h5><p>Executer un conteneur alpine en montant le /tmp local dans le dossier /mon_dossier du conteneur.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run -ti -v /tmp:/mon_dossier alpine sh</span></span></code></pre></div><p>On arrive dans le shell de notre conteneur. Par d√©faut, il n&rsquo;a pas de r√©pertoire /mon_dossier dans l&rsquo;image alpine.<br>Quel est l&rsquo;impact de notre bind mount ?</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ls /mon_dossier</span></span></code></pre></div><p>Le r√©pertoire /mon_dossier √† √©t√© cr√©√© dans le conteneur et contient les fichiers de /tmp de la VM.<br>Nous pouvons maintenant modifier ces fichiers √† partir du conteneur ou de l&rsquo;h√¥te.</p><h5 id=existe>Existe</h5><p>Executer un conteneur nginx en montant le /tmp local dans le dossier /usr/share/nginx/html du conteneur.</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run -ti -v /tmp:/usr/share/nginx/html nginx bash</span></span></code></pre></div><p>Est ce que les fichiers par d√©faut index.html et 50x.html sont pr√©sents dans le dossier /usr/share/nginx/html du conteneur ?</p><div class="wrap-code highlight"><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ls /usr/share/nginx/html</span></span></code></pre></div><p>Non.<br>Le contenu du dossier du conteneur √† √©t√© remplac√© avec le contenu du dossier de l&rsquo;h√¥te.</p><p>Les <strong>bind-mount</strong> sont utiles en mode d√©veloppement car ils permettent, par exemple, de partager le code source de l&rsquo;h√¥te avec le conteneur.</p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class="default-animation showVisitedLinks"><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=logo href=https://zaggash.github.io/tp-iut-docker/><img src=https://www.docker.com/wp-content/uploads/2022/03/Docker-Logo-White-RGB_Horizontal.png alt="Moby Logo"></a></div><div class="searchbox default-animation"><i class="fas fa-search" title="Rechercher (CTRL+ALT+f)"></i>
<label class=a11y-only for=R-search-by>Rechercher</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Rechercher...>
<button class=search-clear type=button data-search-clear title="Recherche claire"><i class="fas fa-times" title="Recherche claire"></i></button></div><script>var contentLangs=["fr"]</script><script src=../../js/auto-complete.js defer></script><script src=../../js/lunr/lunr.min.js defer></script><script src=../../js/lunr/lunr.stemmer.support.min.js defer></script><script src=../../js/lunr/lunr.multi.min.js defer></script><script src=../../js/lunr/lunr.fr.min.js defer></script><script src=../../js/search.js defer></script></div><div id=R-homelinks class="default-animation homelinks"><ul><li><a class=padding href=../../><i class="fas fa-home"></i> Home</a></li></ul><hr class=padding></div><div id=R-content-wrapper class=highlightable><div id=R-topics><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/introduction/><a class=padding href=../../introduction/><b>1. </b>Introduction<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-db5db1cf4b1800282ddcebf5cde99c36 class="morespace collapsible-menu"><li data-nav-id=/introduction/why_docker/ class=alwaysopen><a class=padding href=../../introduction/why_docker/>Pourquoi docker ?<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-9522bda80a017c94f9fa7816eb41d94a class="morespace collapsible-menu"><li data-nav-id=/introduction/why_docker/complex_deployments/><a class=padding href=../../introduction/why_docker/complex_deployments/>Deploiements complexes<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/introduction/why_docker/easier_deployments/><a class=padding href=../../introduction/why_docker/easier_deployments/>Deploiements simplifi√©s<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/introduction/why_docker/before_docker/><a class=padding href=../../introduction/why_docker/before_docker/>Avant Docker<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/introduction/why_docker/after_docker/><a class=padding href=../../introduction/why_docker/after_docker/>Apr√®s Docker<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/introduction/why_docker/vm_container/><a class=padding href=../../introduction/why_docker/vm_container/>Alors, VM ou Conteneur ?<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/introduction/architecture/ class=alwaysopen><a class=padding href=../../introduction/architecture/>Architecture<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-8dd78aacd974ca0f487edd8ce27e2ef1 class="morespace collapsible-menu"><li data-nav-id=/introduction/architecture/internal_architecture/><a class=padding href=../../introduction/architecture/internal_architecture/>Docker Engine<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/introduction/architecture/namespaces_cgroups/><a class=padding href=../../introduction/architecture/namespaces_cgroups/>Namespaces/Cgroups/CoW<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/introduction/install_docker/><a class=padding href=../../introduction/install_docker/>Installer Docker<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/docker/><a class=padding href=../../docker/><b>2. </b>Docker<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-138bddd2d1dc51245528eafa51e353d0 class="morespace collapsible-menu"><li data-nav-id=/docker/work_with_container/ class=alwaysopen><a class=padding href=../../docker/work_with_container/>Travailler avec les conteneurs<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-176425744ccc848804e211a9523c6668 class="morespace collapsible-menu"><li data-nav-id=/docker/work_with_container/background/><a class=padding href=../../docker/work_with_container/background/>Conteneurs en arri√®re-plan<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/docker/work_with_images/ class=alwaysopen><a class=padding href=../../docker/work_with_images/>Travailler avec les images<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-32d468f1adff691781796bb351a0ee95 class="morespace collapsible-menu"><li data-nav-id=/docker/work_with_images/image_vs_container/><a class=padding href=../../docker/work_with_images/image_vs_container/>Image vs Conteneur<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/docker/work_with_images/interactive_image/><a class=padding href=../../docker/work_with_images/interactive_image/>Cr√©ation Image Interactive<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/docker/copy_on_write/><a class=padding href=../../docker/copy_on_write/>Copy-On-Write<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/image_automation/><a class=padding href=../../image_automation/><b>3. </b>Automatisation d'une image<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-b36cd505183559cfa3741c30747a6807 class="morespace collapsible-menu"><li data-nav-id=/image_automation/dockerfile/><a class=padding href=../../image_automation/dockerfile/>Le Dockerfile<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/image_automation/dockerhub/><a class=padding href=../../image_automation/dockerhub/>Le Docker Hub<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/image_automation/github/><a class=padding href=../../image_automation/github/>[Optionel] Github<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/docker_linux/ class=parent><a class=padding href=../../docker_linux/><b>4. </b>Docker et Linux<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-8d725b026beac2fd3a52e1c136d1a6df class="morespace collapsible-menu"><li data-nav-id=/docker_linux/namespaces/><a class=padding href=../../docker_linux/namespaces/>Les Namespaces<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/docker_linux/networks/ class=alwaysopen><a class=padding href=../../docker_linux/networks/>Les R√©seaux<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-92efddb4cd41eb5251794a55e5405049 class="morespace collapsible-menu"><li data-nav-id=/docker_linux/networks/network_driver/><a class=padding href=../../docker_linux/networks/network_driver/>Les Pilotes R√©seau<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/docker_linux/networks/inside_network/><a class=padding href=../../docker_linux/networks/inside_network/>Dans le R√©seau<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/docker_linux/volumes/ class=active><a class=padding href=../../docker_linux/volumes/>Les Volumes<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/orchestration/><a class=padding href=../../orchestration/><b>5. </b>Orchestration<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-ae97e49e06be7cee584413caa628d8b7 class="morespace collapsible-menu"><li data-nav-id=/orchestration/install-compose/><a class=padding href=../../orchestration/install-compose/>Installer docker-compose<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/orchestration/compose-app/><a class=padding href=../../orchestration/compose-app/>Une app Docker Compose<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/orchestration/swarm/ class=alwaysopen><a class=padding href=../../orchestration/swarm/>Swarm<i class="fas fa-check read-icon"></i></a><ul id=R-subsections-34735e663d031252e34ac8f23d2f95dd class="morespace collapsible-menu"><li data-nav-id=/orchestration/swarm/create_swarm/><a class=padding href=../../orchestration/swarm/create_swarm/>Cr√©er son cluster Swarm<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/orchestration/swarm/create_service/><a class=padding href=../../orchestration/swarm/create_service/>Cr√©er un service<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/orchestration/swarm/ingress_overlay/><a class=padding href=../../orchestration/swarm/ingress_overlay/>Le r√©seau Ingress Overlay<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/orchestration/swarm/multi_services_app/><a class=padding href=../../orchestration/swarm/multi_services_app/>Retour sur notre Application<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/orchestration/stacks/><a class=padding href=../../orchestration/stacks/>Les Stacks<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/kubernetes/><a class=padding href=../../kubernetes/><b>6. </b>Kubernetes<i class="fas fa-check read-icon"></i></a></li></ul></div><div id=R-shortcuts><div class="nav-title padding">Aller plus loin</div><ul class=space><li><a class=padding href=https://docs.docker.com/><i class="fas fa-book"></i> Documentation Docker</a></li><li><a class=padding href=https://hub.docker.com/><i class="fab fa-docker"></i> Docker Hub</a></li><li><a class=padding href=https://github.com/zaggash/tp-iut-docker><i class="fab fa-github"></i> D√©p√¥t du TP</a></li><li><a class=padding href=https://www.linkedin.com/in/alexandre-pinon/><i class="fab fa-linkedin"></i> Profil Linkedin</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"></div><div id=R-menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"><div id=R-prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVisitedLinks"><ul><li id=R-select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-language>Langue</label>
<select id=R-select-language onchange="location=baseUri+this.value"></select></div><div class=clear></div></div></li><li id=R-select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Th√®me</label>
<select id=R-select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=R-blue value=blue selected>Blue</option></select></div><div class=clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class="footerVisitedLinks showVisitedLinks"><div class="padding menu-control"><i class="fas fa-history fa-fw"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Supprimer l'historique</button></div><div class=clear></div></div></li></ul></div><div id=R-footer class="footerFooter showFooter"><center><img alt="Github Action badge" src="https://img.shields.io/github/actions/workflow/status/zaggash/tp-iut-docker/run-update-website.yaml?logo=github%20actions&logoColor=white&style=for-the-badge"><p>Cr√©√© pour l'IUT Reims-Chalons-Charleville - Alexandre P.</p></center></div></div></div></aside><script src=../../js/clipboard.min.js defer></script><script src=../../js/perfect-scrollbar.min.js defer></script><script>function useMathJax(e){if(!Object.assign)return;window.MathJax=Object.assign(window.MathJax||{},{loader:{load:["[tex]/mhchem"]},startup:{elements:[".math"]},tex:{inlineMath:[["$","$"],["\\(","\\)"]]},options:{enableMenu:!1}},e)}useMathJax(JSON.parse("{}"))</script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script src=../../js/d3/d3-color.min.js defer></script><script src=../../js/d3/d3-dispatch.min.js defer></script><script src=../../js/d3/d3-drag.min.js defer></script><script src=../../js/d3/d3-ease.min.js defer></script><script src=../../js/d3/d3-interpolate.min.js defer></script><script src=../../js/d3/d3-selection.min.js defer></script><script src=../../js/d3/d3-timer.min.js defer></script><script src=../../js/d3/d3-transition.min.js defer></script><script src=../../js/d3/d3-zoom.min.js defer></script><script src=../../js/js-yaml.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js defer></script><script>window.themeUseMermaid=JSON.parse('{ "theme": "default" }')</script><script src=../../js/theme.js defer></script></body></html>